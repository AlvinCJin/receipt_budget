{% extends "base.html" %}
{% load static %}

{% block title %}Expense dashboard{% endblock %}

{% block content %}
    <div class="type">
        <ul class="nav nav-pills">
            <li class="active"><a href="#">All map</a></li>
            <li><a href="#">Map timeline</a></li>
            <li><a href="#">Line chart</a></li>
        </ul>
    </div>
    <div id="map"></div>
    <button id="next_day">Next day</button>
{% endblock %}

{% block styles %}
<style>
#map {
  width: 100%;
  height: 500px;
  margin: 0;
  padding: 0;
}

.type {
    padding-bottom: 10px;
}
</style>
{% endblock %}
{% block scripts %}
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true&libraries=visualization"></script>

        <script type="text/javascript">

var map = new google.maps.Map($("#map")[0], {
  zoom: 12,
  center: new google.maps.LatLng(46.7752609, 23.6212371),
  mapTypeId: google.maps.MapTypeId.HYBRID
});
var all_data = [];
var i = 0;
// Load the station data. When the data comes back, create an overlay.
$.getJSON("/rest/expenses/day.json", function(data) {
    all_data = data;
    console.log(all_data)
    next_day()


  });
var heatmap =new google.maps.visualization.HeatmapLayer();
function next_day() {
    points = $.map($.grep(all_data[i][1], function(val, i) {
        return val[1] != null && val[2] != null
    }), function(val, i) {
        console.log(val)
        console.log({location: new google.maps.LatLng(val[1], val[2]), weight: val[3]})
        return {location: new google.maps.LatLng(val[2], val[3]), weight: val[4]}
    });
    heatmap.setData(points);
    heatmap.setOptions({radius: 40, opacity: 0.7});
    heatmap.setMap(map);
    i = (i+1) % all_data.length;
}
        $('#next_day').click(function(e) {
            next_day()
        })
    </script>
{% endblock %}